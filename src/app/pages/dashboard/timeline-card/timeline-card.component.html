<mat-card class="cardWithShadow mb-0!">
  <mat-card-content>
    <div class="flex flex-col gap-6">
      <div>
        <mat-card-title>{{ title() }}</mat-card-title>
        @if (subtitle()) {
          <mat-card-subtitle>{{ subtitle() }}</mat-card-subtitle>
        }
      </div>

      @if (groupedEvents().length) {
        <div class="timeline-wrapper relative">
          <span class="timeline-line absolute left-2 top-1 h-full w-px bg-light-secondary" aria-hidden="true"></span>
          <ol class="timeline-list flex flex-col gap-6" aria-label="Historico">
            @for (group of groupedEvents(); track group.key) {
              <li class="timeline-item relative flex gap-4">
                <div class="timeline-dot mt-1 flex size-4 shrink-0 items-center justify-center rounded-full border border-light-secondary bg-white">
                  <span class="size-1.5 rounded-full bg-primary"></span>
                </div>
                <div class="timeline-body min-w-0 flex-1">
                  <div class="timeline-date text-xs font-semibold uppercase tracking-wide text-muted">
                    @if (group.type === 'date') {
                      {{ group.label | date:'dd MMM yyyy':'':'pt-BR'}}
                    } @else {
                      {{ group.label }}
                    }
                  </div>
                  <ul class="timeline-events mt-2 flex flex-col gap-2">
                    @if (group.children?.length) {
                      @for (subgroup of group.children; track subgroup.key) {
                        <li class="timeline-event">
                          <div class="text-xs font-semibold uppercase tracking-wide text-muted">
                            @if (subgroup.type === 'date') {
                              {{ subgroup.label | date:'dd MMM yyyy':'':'pt-BR'}}
                            } @else {
                              {{ subgroup.label }}
                            }
                          </div>
                          <ul class="timeline-subevents mt-2 flex flex-col gap-2">
                            @if (subgroup.children?.length) {
                              @for (tertiary of subgroup.children; track tertiary.key) {
                                <li class="timeline-event timeline-event--nested">
                                  <div class="text-xs font-semibold uppercase tracking-wide text-muted">
                                    @if (tertiary.type === 'date') {
                                      {{ tertiary.label | date:'dd MMM yyyy':'':'pt-BR'}}
                                    } @else {
                                      {{ tertiary.label }}
                                    }
                                  </div>
                                  <ul class="timeline-subevents mt-2 flex flex-col gap-2">
                                    @for (event of tertiary.items ?? []; track event.key) {
                                      <li class="timeline-event timeline-event--nested">
                                        <div class="flex flex-wrap items-center gap-2">
                                          @if (!hideItemTime() && event.hasTime) {
                                            <div class="text-xs font-semibold text-muted">
                                              {{ event.localDate | date:'HH:mm':'':'pt-BR'}}
                                            </div>
                                          }
                                          @if (!hideItemTitle()) {
                                            <div class="timeline-title text-sm font-semibold text-dark">
                                              {{ event.title }}
                                            </div>
                                          }
                                        </div>
                                        @if (event.description) {
                                          <div class="mt-1 text-xs text-muted">{{ event.description }}</div>
                                        }
                                      </li>
                                    }
                                  </ul>
                                </li>
                              }
                            } @else {
                              @for (event of subgroup.items ?? []; track event.key) {
                                <li class="timeline-event timeline-event--nested">
                                  <div class="flex flex-wrap items-center gap-2">
                                    @if (!hideItemTime() && event.hasTime) {
                                      <div class="text-xs font-semibold text-muted">
                                        {{ event.localDate | date:'HH:mm':'':'pt-BR'}}
                                      </div>
                                    }
                                    @if (!hideItemTitle()) {
                                      <div class="timeline-title text-sm font-semibold text-dark">
                                        {{ event.title }}
                                      </div>
                                    }
                                  </div>
                                  @if (event.description) {
                                    <div class="mt-1 text-xs text-muted">{{ event.description }}</div>
                                  }
                                </li>
                              }
                            }
                          </ul>
                        </li>
                      }
                    } @else {
                      @for (event of group.items ?? []; track event.key) {
                        <li class="timeline-event">
                          <div class="flex flex-wrap items-center gap-2">
                            @if (!hideItemTime() && event.hasTime) {
                              <div class="text-xs font-semibold text-muted">
                                {{ event.localDate | date:'HH:mm':'':'pt-BR'}}
                              </div>
                            }
                            @if (!hideItemTitle()) {
                              <div class="timeline-title text-sm font-semibold text-dark">{{ event.title }}</div>
                            }
                          </div>
                          @if (event.description) {
                            <div class="mt-1 text-xs text-muted">{{ event.description }}</div>
                          }
                        </li>
                      }
                    }
                  </ul>
                </div>
              </li>
            }
          </ol>
        </div>
      } @else {
        <div class="text-sm text-muted">Sem eventos para exibir.</div>
      }
    </div>
  </mat-card-content>
</mat-card>
