<mat-card class="cardWithShadow overflow-hidden">
  <!-- ------------------------------------------------------ -->
  <!-- Toggle mobile -->
  <!-- ------------------------------------------------------ -->
  <div class="bg-primary text-white p-2 block xl:hidden">
    <div class="flex items-center">
      <button (click)="mailnav.toggle()" class="text-white!" mat-icon-button>
        <mat-icon>short_text</mat-icon>
      </button>
      <div class="text-sm mb-0 ms-4">Inbox</div>
    </div>
  </div>
  <!-- ------------------------------------------------------ -->
  <!-- Desktop App -->
  <!-- ------------------------------------------------------ -->
  <mat-sidenav-container class="email-box" [ngClass]="{
      'side-panel-opened': sidePanelOpened(),
      'side-panel-closed': !sidePanelOpened()
    }">
    <!-- ------------------------------------------------------ -->
    <!-- Sidebar Email -->
    <!-- ------------------------------------------------------ -->
    <mat-sidenav #mailnav [mode]="isOver() ? 'over' : 'side'" [opened]="!isOver()" (open)="sidePanelOpened.set(true)"
      (close)="sidePanelOpened.set(false)" class="mail-sidebar w-60!">
      <div class="p-4 pb-0">
        <button mat-flat-button (click)="openDialog()" color="primary" class="w-full btn-block">
          Compose
        </button>
      </div>
      <ng-scrollbar style="height: calc(100vh - 330px)" class="relative">
        <div class="p-4">
          <mat-nav-list>
            @for(mail of mailboxes(); track mail.name) {
            <mat-list-item role="listitem" (click)="mailboxesChanged(mail.name)" [class.bg-light-primary]="mail.active"
              class="mb-0! gap-2 items-center">
              <span matListItemIcon class="me-0! flex flex-row items-center self-stretch justify-center">
                <i-tabler name="{{ mail.icon }}" class="size-5!"></i-tabler>
              </span>
              <span matListItemTitle class="font-normal text-sm">{{
                mail.name
                }}</span>
            </mat-list-item>
            }
          </mat-nav-list>
        </div>
        <h5 class="m-0 pt-4 px-8 text-sm font-semibold border-t border-border">Sort By</h5>
        <div class="px-4">
          <mat-nav-list>
            @for(fil of filters(); track fil.name) {
            <mat-list-item role="listitem" (click)="filtersClick(fil.name)"
              [class.bg-light-primary]="activeFilter() === fil.name" class="mb-0.5 gap-2 items-center">
              <span matListItemIcon class="me-0! flex flex-row items-center self-stretch justify-center">
                <i-tabler name="{{ fil.icon }}" class="size-5!"></i-tabler>
              </span>
              <span class="font-normal text-sm" matListItemTitle>{{
                fil.name
                }}</span>
            </mat-list-item>
            }
          </mat-nav-list>
        </div>
        <h5 class="m-0 pt-4 px-8 text-sm font-semibold border-t border-border">Labels</h5>
        <div class="px-4">
          <mat-nav-list>
            @for(lab of labels(); track lab.name) {
            <mat-list-item role="listitem" (click)="labelChange(lab.name)"
              [class.bg-light-primary]="activeLabel() === lab.name" class="mb-0.5 gap-2 items-center">
              <span matListItemIcon class="me-0! flex flex-row items-center self-stretch justify-center">
                <i-tabler [style.color]="lab.color" name="{{ lab.icon }}" class="size-5!"></i-tabler>
              </span>
              <span class="font-normal text-sm" matListItemTitle>{{
                lab.name
                }}</span>
            </mat-list-item>
            }
          </mat-nav-list>
        </div>
      </ng-scrollbar>
    </mat-sidenav>
    <mat-sidenav-content>
      <!-- ------------------------------------------------------ -->
      <!-- Email Listing and Details-->
      <!-- ------------------------------------------------------ -->
      <div class="">
        <div class="grid grid-cols-12 h-full">
          <!-- ------------------------------------------------------ -->
          <!-- Listing -->
          <!-- ------------------------------------------------------ -->
          <div class="col-span-12 lg:col-span-4 border-r rtl:border-l rtl:border-r-0 border-border p-0">
            <div class="px-4 flex items-center justify-between">
              <h5 class="font-medium text-base m-0">
                {{ ms.topLabel() }}
              </h5>
              <pagination-controls (pageChange)="p.set($event)" previousLabel="" nextLabel="" class="mail-pagination">
              </pagination-controls>
            </div>
            <mat-divider></mat-divider>
            @if(ms.mailList().length){
            <ng-scrollbar style="height: calc(100vh - 320px)" class="relative">
              <mat-nav-list class="stats-wrapper p-0!">
                @for(mail of ms.mailList() | paginate : { itemsPerPage: 6,
                currentPage: p() }; track mail; let i = $index) {
                <mat-list-item (click)="mailSelected(mail)" [class.bg-light-primary]="
                    mail.MailId == selectedIndex() && mail.mailbox !== 'Trash'
                  " class="rounded-none! border-b border-border! gap-2 stat-item">
                  <mat-checkbox matListItemIcon [(ngModel)]="mail.isChecked" (change)="onCheckboxChange(mail)"
                    (click)="$event.stopPropagation()" class="ms-2"></mat-checkbox>

                  <div class="flex! items-center justify-between w-full mt-2! mb-0!" matListItemTitle>
                    <h5 class="m-0 font-semibold w-full text-base">
                      {{ ms.users()[i].name }}
                    </h5>
                    @if(mail.label[0] == 'Accounts') {
                    <span>
                      <span class="bg-warning rounded-sm px-2 text-white text-xs py-1">
                        {{ mail.label[0] }}</span>
                    </span>
                    } @if(mail.label[0] == 'Personal') {
                    <span>
                      <span class="bg-primary rounded-sm px-2 text-white text-xs py-1">
                        {{ mail.label[0] }}</span>
                    </span>
                    } @if(mail.label[0] == 'Work') {
                    <span>
                      <span class="bg-secondary rounded-sm px-2 text-white text-xs py-1">
                        {{ mail.label[0] }}</span>
                    </span>
                    } @if(mail.label[0] == 'Payments') {
                    <span>
                      <span class="bg-error rounded-sm px-2 text-white text-xs py-1">
                        {{ mail.label[0] }}</span>
                    </span>
                    }
                  </div>
                  <span class="text-sm py-1 flex!" matListItemLine>
                    {{ mail.Subject | slice : 0 : 24 }}..
                  </span>
                  <!-- icons -->
                  <div class="flex! justify-center mt-2" matListItemLine>
                    <!-- star icon -->

                    <span class="me-2! flex" (click)="iconsClick('Star')">
                      @if(mail.filter.includes('Star')){
                      <i-tabler name="star" class="size-4.5! fill-warning">
                      </i-tabler>
                      }@else{
                      <i-tabler name="star" class="size-4.5!"></i-tabler>
                      }
                    </span>
                    <!-- inform icon -->

                    <span class="me-2 flex" (click)="iconsClick('Important')">
                      @if( mail.filter.includes('Important')){
                      <i-tabler name="alert-circle" class="size-4.5! text-error">
                      </i-tabler>
                      }@else{
                      <i-tabler name="alert-circle" class="size-4.5!"></i-tabler>
                      }
                    </span>
                    <!-- Delete Icon -->
                    @if(mail.isChecked){
                    <i-tabler name="trash" class="size-4.5!" (click)="deleteItem(mail)"
                      style="cursor: pointer"></i-tabler>
                    }

                    <div class="ms-auto text-end">
                      <span class="text-xs text-nowrap">{{
                        mail.date | date : "dd-MMM"
                        }}</span>
                    </div>
                  </div>
                </mat-list-item>
                }
              </mat-nav-list>
            </ng-scrollbar>
            } @else{
            <p>No emails found.</p>
            }
          </div>
          <!-- ------------------------------------------------------ -->
          <!-- Details of Email -->
          <!-- ------------------------------------------------------ -->
          <div class="col-span-12 lg:col-span-8 detail-part p-0" [class.movetodetail]="showDetail()">
            @if(ms.selectedMail() === null) {
            <div class="h-full welcome-app">
              <div class="flex items-center justify-center h-full w-full">
                <div>
                  <h3 class="text-[21px] font-semibold">Please Select a Mail</h3>
                  <img src="/assets/images/breadcrumb/emailSv.png" width="250px" />
                </div>
              </div>
            </div>
            } @if(ms.selectedMail() !== null) {
            <div class="w-full">
              <app-maildetail></app-maildetail>
            </div>
            }
          </div>
        </div>
      </div>
    </mat-sidenav-content>
  </mat-sidenav-container>
</mat-card>